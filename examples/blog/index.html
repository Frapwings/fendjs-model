
<style>
  body {
    font: 14px "Helvetica Neue", Helvetica, arial, sans-serif;
    padding: 60px;
  }
  p {
    margin: 5px;
  }
  input[type='text'] {
    padding: 5px 10px;
    border-width: 1px;
    -webkit-border-radius: 2px;
  }
</style>

<script src="build.js"></script>

<script>
   var domify = require('component-domify');

   // TODO: remove all this, real example..

   function errorHTML(Model) {
     Model.prototype.errorHTML = function(){
       return '<ul class=errors>\n' + this.errors.map(function(err){
         return '  <li>' + err.attr + ' ' + err.message + '</li>';
       }).join('\n') + '\n</ul>';
     };
   }

  function formHTML(Model) {
    Model.prototype.form = function(){
      var model = this.model;
      var attrs = model.attrs;
      var save = this.isNew() ? 'Save' : 'Update';
      var url = this.isNew() ? model.url() : this.url();
      var html = '';
      var attr;

      html += '<form action="' + url + '">\n';

      for (var name in attrs) {
        attr = attrs[name];
        if (attr.primaryKey) continue;
        if (false === attr.show) continue;
        html += '  <p>\n';
        html += '    <input type="text" placeholder="' + name + '" name="' + name + '" />\n';
        html += '  </p>\n\n';
      }

      html += '  <div class=actions>\n';
      html += '    <input type="submit" value="' + save + '"></input>\n';
      html += '  </div>\n';
      html += '</form>\n';

      return html;
    };
  }

  function required(attr) {
    return function(Model){
      Model.validate(function(model){
        if (!model.has(attr)) model.error(attr, 'field required');
      });
    }
  }

  function lengthAbove(attr, len) {
    return function(Model){
      Model.validate(function(model){
        if (!model.has(attr)) return;
        var str = model.get(attr);
        if (str.length <= len) model.error(attr, 'must be longer than ' + len + ' characters'); 
      });
    }
  }

  var model = require('model');

  var Post = model('Post')
    .attr('id', { type: 'number' })
    .attr('title', { type: 'string' })
    .attr('body', { type: 'string' })
    .attr('create_at', { type: 'date', show: false })
    .attr('update_at', { type: 'date', show: false })
    .use(errorHTML)
    .use(formHTML)
    .use(required('title'))
    .use(required('body'))
    .use(lengthAbove('title', 3))
    .use(lengthAbove('body', 20))

  var post = new Post({ title: 'Something', body: 'Some other thing here' });

  post.save(function(err){

  });
  
</script>